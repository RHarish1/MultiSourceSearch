generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

//
//  ENUMS
//
enum providerType {
  google
  onedrive
  dropbox
}

//
//  MODELS
//

/// Drives table
model drives {
  id           String        @id @default(uuid()) @db.Uuid
  provider     providerType
  accessToken  String
  refreshToken String
  expiry       DateTime?     @db.Timestamptz(6)
  email        String?       @db.VarChar(255)
  rootFolderId String?       @db.VarChar(255)
  userId       String        @db.Uuid
  createdAt    DateTime      @default(now()) @db.Timestamptz(6)
  updatedAt    DateTime      @updatedAt @db.Timestamptz(6)

  users        users         @relation(fields: [userId], references: [id], onDelete: Cascade)
  images       images[]

  @@unique([userId, provider], map: "drives_user_id_provider")
}

/// Image-tag junction
model image_tags {
  imageId String @db.Uuid
  tagId   String @db.Uuid

  images  images @relation(fields: [imageId], references: [id], onDelete: Cascade)
  tags    tags   @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([imageId, tagId])
  @@unique([imageId, tagId], map: "image_tags_image_id_tag_id")
}

/// Images
model images {
  id           String     @id @default(uuid()) @db.Uuid
  userId       String     @db.Uuid
  driveId      String     @db.Uuid
  fileId       String     @db.VarChar(255)
  provider     String     @db.VarChar(255)
  fileName     String?    @db.VarChar(255)
  fileUrl      String?    @db.VarChar(255)
  thumbnailUrl String?    @db.VarChar(255)
  mimeType     String?    @db.VarChar(255)
  size         Int?
  uploadedAt   DateTime?  @db.Timestamptz(6)
  createdAt    DateTime   @default(now()) @db.Timestamptz(6)
  updatedAt    DateTime   @updatedAt @db.Timestamptz(6)

  image_tags   image_tags[]
  drives       drives     @relation(fields: [driveId], references: [id], onDelete: Cascade)
  users        users      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

/// Tags

model tags {
  id         String       @id @default(uuid()) @db.Uuid
  name       String       @unique @db.VarChar(255)
  createdAt  DateTime     @default(now()) @db.Timestamptz(6)
  updatedAt  DateTime     @updatedAt @db.Timestamptz(6)
  userId     String?      @db.Uuid
  image_tags image_tags[]
  users      users?       @relation(fields: [userId], references: [id])
}

/// Users
model users {
  id           String   @id @default(uuid()) @db.Uuid
  username     String   @unique @db.VarChar(255)
  email        String   @unique @db.VarChar(255)
  passwordHash String?  @db.VarChar(255)
  createdAt    DateTime @default(now()) @db.Timestamptz(6)
  updatedAt    DateTime @updatedAt @db.Timestamptz(6)

  drives       drives[]
  images       images[]
  tags         tags[]
}
